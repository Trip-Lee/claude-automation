<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ServiceNow Dependency Graph - Complete</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow: hidden;
        }

        #container {
            display: flex;
            height: 100vh;
        }

        #sidebar {
            width: 320px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 2px 0 20px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
            z-index: 10;
            transition: transform 0.3s ease;
        }

        #sidebar.collapsed {
            transform: translateX(-320px);
        }

        #toggle-sidebar {
            position: absolute;
            left: 320px;
            top: 20px;
            z-index: 11;
            background: white;
            border: none;
            padding: 8px 12px;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
            transition: left 0.3s ease;
        }

        #toggle-sidebar.collapsed {
            left: 0;
        }

        .sidebar-header {
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .sidebar-header h1 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .stat {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px;
            border-radius: 4px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .stat-label {
            font-size: 0.75rem;
            opacity: 0.9;
            text-transform: uppercase;
        }

        .controls {
            padding: 20px;
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        .control-group input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }

        .control-group input[type="text"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            font-weight: normal;
            cursor: pointer;
        }

        .checkbox-group input[type="checkbox"] {
            margin-right: 8px;
        }

        .legend {
            padding: 20px;
            border-top: 1px solid #eee;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        #graph {
            flex: 1;
            position: relative;
            background: white;
        }

        #svg-container {
            width: 100%;
            height: 100%;
        }

        .node {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .node:hover {
            filter: brightness(1.2);
        }

        .node.highlight {
            stroke: #ff6b6b;
            stroke-width: 3px;
            filter: drop-shadow(0 0 10px rgba(255, 107, 107, 0.5));
        }

        .node.dimmed {
            opacity: 0.2;
        }

        .link {
            fill: none;
            stroke-opacity: 0.4;
            transition: all 0.3s ease;
        }

        .link.highlight {
            stroke-opacity: 1;
            stroke-width: 3px;
        }

        .link.dimmed {
            stroke-opacity: 0.05;
        }

        .node-label {
            font-size: 10px;
            pointer-events: none;
            user-select: none;
            fill: #333;
            text-shadow: 0 0 3px white, 0 0 3px white, 0 0 3px white;
        }

        .tooltip {
            position: absolute;
            padding: 12px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            max-width: 300px;
            z-index: 100;
        }

        .tooltip.show {
            opacity: 1;
        }

        .context-menu {
            position: absolute;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 8px 0;
            display: none;
            z-index: 100;
        }

        .context-menu.show {
            display: block;
        }

        .context-menu-item {
            padding: 8px 16px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .context-menu-item:hover {
            background: #f0f0f0;
        }

        .export-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .export-btn {
            flex: 1;
            padding: 8px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .export-btn:hover {
            transform: translateY(-2px);
        }

        #search-results {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-top: 5px;
            display: none;
        }

        #search-results.show {
            display: block;
        }

        .search-result {
            padding: 8px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
        }

        .search-result:hover {
            background: #f8f8f8;
        }

        .search-result-type {
            font-size: 0.75rem;
            color: #666;
            margin-left: 5px;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="sidebar">
            <div class="sidebar-header">
                <h1>Dependency Graph</h1>
                <div class="stats">
                    <div class="stat">
                        <div class="stat-value">75</div>
                        <div class="stat-label">Nodes</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">46</div>
                        <div class="stat-label">Links</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">36</div>
                        <div class="stat-label">Components</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">39</div>
                        <div class="stat-label">APIs</div>
                    </div>
                </div>
            </div>

            <div class="controls">
                <div class="control-group">
                    <label for="search">Search Nodes:</label>
                    <input type="text" id="search" placeholder="Type to search...">
                    <div id="search-results"></div>
                </div>

                <div class="control-group">
                    <label for="force-strength">Force Strength: <span id="force-value">-300</span></label>
                    <input type="range" id="force-strength" min="-1000" max="-50" value="-300">
                </div>

                <div class="control-group">
                    <label for="link-distance">Link Distance: <span id="distance-value">100</span></label>
                    <input type="range" id="link-distance" min="20" max="300" value="100">
                </div>

                <div class="control-group">
                    <label>Show Node Types:</label>
                    <div class="checkbox-group">
                        <label><input type="checkbox" checked class="node-filter" data-type="component"> Components</label>
                        <label><input type="checkbox" checked class="node-filter" data-type="api"> REST APIs</label>
                        <label><input type="checkbox" checked class="node-filter" data-type="scriptInclude"> Script Includes</label>
                        <label><input type="checkbox" checked class="node-filter" data-type="table"> Tables</label>
                    </div>
                </div>

                <div class="control-group">
                    <label>Show Labels:</label>
                    <div class="checkbox-group">
                        <label><input type="checkbox" checked id="show-labels"> Node Labels</label>
                    </div>
                </div>

                <div class="export-buttons">
                    <button class="export-btn" onclick="exportSVG()">Export SVG</button>
                    <button class="export-btn" onclick="exportPNG()">Export PNG</button>
                    <button class="export-btn" onclick="exportJSON()">Export JSON</button>
                </div>
            </div>

            <div class="legend">
                <h3 style="margin-bottom: 15px;">Legend</h3>
                <div class="legend-item">
                    <div class="legend-color" style="background: #4CAF50;"></div>
                    <span>Component</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #2196F3;"></div>
                    <span>REST API</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #FF9800;"></div>
                    <span>Script Include</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #9C27B0;"></div>
                    <span>Table</span>
                </div>
            </div>
        </div>

        <button id="toggle-sidebar" onclick="toggleSidebar()">☰</button>

        <div id="graph">
            <svg id="svg-container"></svg>
            <div class="tooltip"></div>
            <div class="context-menu">
                <div class="context-menu-item" onclick="focusNode()">Focus on this node</div>
                <div class="context-menu-item" onclick="showConnections()">Show connections</div>
                <div class="context-menu-item" onclick="hideNode()">Hide this node</div>
                <div class="context-menu-item" onclick="copyNodeInfo()">Copy node info</div>
            </div>
        </div>
    </div>

    <script>
        // Graph data
        const graphData = {"nodes":[{"id":"component:Avatar","label":"Avatar","type":"component","nodeId":0,"path":"G:\\Work\\Tenon\\Tenon Repo\\Sashimono\\Avatar","componentType":"Sashimono","apiCount":0,"actionCount":1},{"id":"component:Breadcrumbs","label":"Breadcrumbs","type":"component","nodeId":1,"path":"G:\\Work\\Tenon\\Tenon Repo\\Sashimono\\Breadcrumbs","componentType":"Sashimono","apiCount":0,"actionCount":2},{"id":"component:Button","label":"Button","type":"component","nodeId":2,"path":"G:\\Work\\Tenon\\Tenon Repo\\Sashimono\\Button","componentType":"Sashimono","apiCount":0,"actionCount":2},{"id":"component:CheckboxChoice","label":"CheckboxChoice","type":"component","nodeId":3,"path":"G:\\Work\\Tenon\\Tenon Repo\\Sashimono\\CheckboxChoice","componentType":"Sashimono","apiCount":0,"actionCount":2},{"id":"component:Choice","label":"Choice","type":"component","nodeId":4,"path":"G:\\Work\\Tenon\\Tenon Repo\\Sashimono\\Choice","componentType":"Sashimono","apiCount":1,"actionCount":17},{"id":"api:/api/x_cadso_work/ui/choice/fetch","label":"/api/x_cadso_work/ui/choice/fetch","type":"api","nodeId":5,"endpoint":"/api/x_cadso_work/ui/choice/fetch"},{"id":"component:Collapse","label":"Collapse","type":"component","nodeId":6,"path":"G:\\Work\\Tenon\\Tenon Repo\\Sashimono\\Collapse","componentType":"Sashimono","apiCount":0,"actionCount":1},{"id":"component:ColorPicker","label":"ColorPicker","type":"component","nodeId":7,"path":"G:\\Work\\Tenon\\Tenon Repo\\Sashimono\\ColorPicker","componentType":"Sashimono","apiCount":0,"actionCount":5},{"id":"component:ContextMenu","label":"ContextMenu","type":"component","nodeId":8,"path":"G:\\Work\\Tenon\\Tenon Repo\\Sashimono\\ContextMenu","componentType":"Sashimono","apiCount":0,"actionCount":2},{"id":"component:COPY ME","label":"COPY ME","type":"component","nodeId":9,"path":"G:\\Work\\Tenon\\Tenon Repo\\Sashimono\\COPY ME","componentType":"Sashimono","apiCount":0,"actionCount":1},{"id":"component:CopyField","label":"CopyField","type":"component","nodeId":10,"path":"G:\\Work\\Tenon\\Tenon Repo\\Sashimono\\CopyField","componentType":"Sashimono","apiCount":0,"actionCount":3},{"id":"component:Currency","label":"Currency","type":"component","nodeId":11,"path":"G:\\Work\\Tenon\\Tenon Repo\\Sashimono\\Currency","componentType":"Sashimono","apiCount":0,"actionCount":2},{"id":"component:DateTime","label":"DateTime","type":"component","nodeId":12,"path":"G:\\Work\\Tenon\\Tenon Repo\\Sashimono\\DateTime","componentType":"Sashimono","apiCount":1,"actionCount":18},{"id":"api:/api/x_cadso_work/ui/FormateDates","label":"/api/x_cadso_work/ui/FormateDates","type":"api","nodeId":13,"endpoint":"/api/x_cadso_work/ui/FormateDates"},{"id":"component:DayOf","label":"DayOf","type":"component","nodeId":14,"path":"G:\\Work\\Tenon\\Tenon Repo\\Sashimono\\DayOf","componentType":"Sashimono","apiCount":0,"actionCount":1},{"id":"component:FavoriteStar","label":"FavoriteStar","type":"component","nodeId":15,"path":"G:\\Work\\Tenon\\Tenon Repo\\Sashimono\\FavoriteStar","componentType":"Sashimono","apiCount":2,"actionCount":5},{"id":"api:/api/x_cadso_work/ui/favorites/fetch","label":"/api/x_cadso_work/ui/favorites/fetch","type":"api","nodeId":16,"endpoint":"/api/x_cadso_work/ui/favorites/fetch"},{"id":"api:/api/x_cadso_work/ui/favorites/post","label":"/api/x_cadso_work/ui/favorites/post","type":"api","nodeId":17,"endpoint":"/api/x_cadso_work/ui/favorites/post"},{"id":"component:MultiGlideList","label":"MultiGlideList","type":"component","nodeId":18,"path":"G:\\Work\\Tenon\\Tenon Repo\\Sashimono\\MultiGlideList","componentType":"Sashimono","apiCount":1,"actionCount":16},{"id":"api:/api/x_cadso_work/ui/multiList/fetch","label":"/api/x_cadso_work/ui/multiList/fetch","type":"api","nodeId":19,"endpoint":"/api/x_cadso_work/ui/multiList/fetch"},{"id":"component:Number","label":"Number","type":"component","nodeId":20,"path":"G:\\Work\\Tenon\\Tenon Repo\\Sashimono\\Number","componentType":"Sashimono","apiCount":0,"actionCount":2},{"id":"component:Options","label":"Options","type":"component","nodeId":21,"path":"G:\\Work\\Tenon\\Tenon Repo\\Sashimono\\Options","componentType":"Sashimono","apiCount":0,"actionCount":4},{"id":"component:Preview","label":"Preview","type":"component","nodeId":22,"path":"G:\\Work\\Tenon\\Tenon Repo\\Sashimono\\Preview","componentType":"Sashimono","apiCount":1,"actionCount":3},{"id":"api:/api/x_cadso_core/component/fetchPreview/:table/:sysId","label":"/api/x_cadso_core/component/fetchPreview/:table/:sysId","type":"api","nodeId":23,"endpoint":"/api/x_cadso_core/component/fetchPreview/:table/:sysId"},{"id":"component:RecordHeader","label":"RecordHeader","type":"component","nodeId":24,"path":"G:\\Work\\Tenon\\Tenon Repo\\Sashimono\\RecordHeader","componentType":"Sashimono","apiCount":0,"actionCount":3},{"id":"component:SidePanel","label":"SidePanel","type":"component","nodeId":25,"path":"G:\\Work\\Tenon\\Tenon Repo\\Sashimono\\SidePanel","componentType":"Sashimono","apiCount":0,"actionCount":4},{"id":"component:TextArea","label":"TextArea","type":"component","nodeId":26,"path":"G:\\Work\\Tenon\\Tenon Repo\\Sashimono\\TextArea","componentType":"Sashimono","apiCount":0,"actionCount":9},{"id":"component:Time","label":"Time","type":"component","nodeId":27,"path":"G:\\Work\\Tenon\\Tenon Repo\\Sashimono\\Time","componentType":"Sashimono","apiCount":1,"actionCount":8},{"id":"component:UpdateFieldsChoice","label":"UpdateFieldsChoice","type":"component","nodeId":28,"path":"G:\\Work\\Tenon\\Tenon Repo\\Sashimono\\UpdateFieldsChoice","componentType":"Sashimono","apiCount":1,"actionCount":17},{"id":"api:/api/x_cadso_journey/ui/updateFields/fetch","label":"/api/x_cadso_journey/ui/updateFields/fetch","type":"api","nodeId":29,"endpoint":"/api/x_cadso_journey/ui/updateFields/fetch"},{"id":"component:BrandKit","label":"BrandKit","type":"component","nodeId":30,"path":"G:\\Work\\Tenon\\Tenon Repo\\component-library\\BrandKit","componentType":"Component Library","apiCount":2,"actionCount":11},{"id":"api:/api/x_cadso_core/ui/brandKit/:sysId","label":"/api/x_cadso_core/ui/brandKit/:sysId","type":"api","nodeId":31,"endpoint":"/api/x_cadso_core/ui/brandKit/:sysId"},{"id":"api:/api/x_cadso_core/ui/brandKit","label":"/api/x_cadso_core/ui/brandKit","type":"api","nodeId":32,"endpoint":"/api/x_cadso_core/ui/brandKit"},{"id":"component:ContentViewer","label":"ContentViewer","type":"component","nodeId":33,"path":"G:\\Work\\Tenon\\Tenon Repo\\component-library\\ContentViewer","componentType":"Component Library","apiCount":1,"actionCount":1},{"id":"api:api/now/table/:table/:sysId","label":"api/now/table/:table/:sysId","type":"api","nodeId":34,"endpoint":"api/now/table/:table/:sysId"},{"id":"component:Editor","label":"Editor","type":"component","nodeId":35,"path":"G:\\Work\\Tenon\\Tenon Repo\\component-library\\Editor","componentType":"Component Library","apiCount":9,"actionCount":36},{"id":"api:/api/x_cadso_automate/ui/content_service/token","label":"/api/x_cadso_automate/ui/content_service/token","type":"api","nodeId":36,"endpoint":"/api/x_cadso_automate/ui/content_service/token"},{"id":"api:/api/x_cadso_automate/ui/content_templates/:sys_id","label":"/api/x_cadso_automate/ui/content_templates/:sys_id","type":"api","nodeId":37,"endpoint":"/api/x_cadso_automate/ui/content_templates/:sys_id"},{"id":"api:/api/x_cadso_automate/ui/template_catalog/templates/:item_id","label":"/api/x_cadso_automate/ui/template_catalog/templates/:item_id","type":"api","nodeId":38,"endpoint":"/api/x_cadso_automate/ui/template_catalog/templates/:item_id"},{"id":"api:/api/x_cadso_automate/ui/content_templates","label":"/api/x_cadso_automate/ui/content_templates","type":"api","nodeId":39,"endpoint":"/api/x_cadso_automate/ui/content_templates"},{"id":"api:/api/x_cadso_automate/ui/email/:sys_id","label":"/api/x_cadso_automate/ui/email/:sys_id","type":"api","nodeId":40,"endpoint":"/api/x_cadso_automate/ui/email/:sys_id"},{"id":"api:/api/x_cadso_automate/ui/brandKit/:sysId","label":"/api/x_cadso_automate/ui/brandKit/:sysId","type":"api","nodeId":41,"endpoint":"/api/x_cadso_automate/ui/brandKit/:sysId"},{"id":"api:/api/x_cadso_core/merge_tags","label":"/api/x_cadso_core/merge_tags","type":"api","nodeId":42,"endpoint":"/api/x_cadso_core/merge_tags"},{"id":"api:/api/x_cadso_core/ui/brandKit/all","label":"/api/x_cadso_core/ui/brandKit/all","type":"api","nodeId":43,"endpoint":"/api/x_cadso_core/ui/brandKit/all"},{"id":"component:FormEditor","label":"FormEditor","type":"component","nodeId":44,"path":"G:\\Work\\Tenon\\Tenon Repo\\component-library\\FormEditor","componentType":"Component Library","apiCount":0,"actionCount":1},{"id":"component:MergeTags","label":"MergeTags","type":"component","nodeId":45,"path":"G:\\Work\\Tenon\\Tenon Repo\\component-library\\MergeTags","componentType":"Component Library","apiCount":3,"actionCount":23},{"id":"api:/api/x_cadso_core/merge_tags/:sys_id","label":"/api/x_cadso_core/merge_tags/:sys_id","type":"api","nodeId":46,"endpoint":"/api/x_cadso_core/merge_tags/:sys_id"},{"id":"api:/api/x_cadso_core/tables/:tableName/fields","label":"/api/x_cadso_core/tables/:tableName/fields","type":"api","nodeId":47,"endpoint":"/api/x_cadso_core/tables/:tableName/fields"},{"id":"component:Modal","label":"Modal","type":"component","nodeId":48,"path":"G:\\Work\\Tenon\\Tenon Repo\\component-library\\Modal","componentType":"Component Library","apiCount":2,"actionCount":19},{"id":"api:/api/x_cadso_work/ui/requests/reject","label":"/api/x_cadso_work/ui/requests/reject","type":"api","nodeId":49,"endpoint":"/api/x_cadso_work/ui/requests/reject"},{"id":"api:/api/x_cadso_work/ui/navheader/event","label":"/api/x_cadso_work/ui/navheader/event","type":"api","nodeId":50,"endpoint":"/api/x_cadso_work/ui/navheader/event"},{"id":"component:RecordDetails","label":"RecordDetails","type":"component","nodeId":51,"path":"G:\\Work\\Tenon\\Tenon Repo\\component-library\\RecordDetails","componentType":"Component Library","apiCount":2,"actionCount":5},{"id":"api:api/x_cadso_work/ui/list2","label":"api/x_cadso_work/ui/list2","type":"api","nodeId":52,"endpoint":"api/x_cadso_work/ui/list2"},{"id":"api:api/x_cadso_work/ui/list","label":"api/x_cadso_work/ui/list","type":"api","nodeId":53,"endpoint":"api/x_cadso_work/ui/list"},{"id":"component:RichTextEditor","label":"RichTextEditor","type":"component","nodeId":54,"path":"G:\\Work\\Tenon\\Tenon Repo\\component-library\\RichTextEditor","componentType":"Component Library","apiCount":7,"actionCount":4},{"id":"api:api/x_cadso_work/ui/complex_filter/additionalfiltersfetch","label":"api/x_cadso_work/ui/complex_filter/additionalfiltersfetch","type":"api","nodeId":55,"endpoint":"api/x_cadso_work/ui/complex_filter/additionalfiltersfetch"},{"id":"api:/api/now/uxframework/macroponent_drivers,/api/now/uxframework/component_drivers,/api/now/uxframework/scripted_conditions,/api/now/uxframework/scripted_route_conditions,/api/now/uxf/databroker/exec,/api/now/graphql","label":"/api/now/uxframework/macroponent_drivers,/api/now/uxframework/component_drivers,/api/now/uxframework/scripted_conditions,/api/now/uxframework/scripted_route_conditions,/api/now/uxf/databroker/exec,/api/now/graphql","type":"api","nodeId":56,"endpoint":"/api/now/uxframework/macroponent_drivers,/api/now/uxframework/component_drivers,/api/now/uxframework/scripted_conditions,/api/now/uxframework/scripted_route_conditions,/api/now/uxf/databroker/exec,/api/now/graphql"},{"id":"api:/api/now/v1/checklist/34edb69753d2030038e7e91b06dc343f/checklistItems/33e9ca2d531b030038e7e91b06dc3458","label":"/api/now/v1/checklist/34edb69753d2030038e7e91b06dc343f/checklistItems/33e9ca2d531b030038e7e91b06dc3458","type":"api","nodeId":57,"endpoint":"/api/now/v1/checklist/34edb69753d2030038e7e91b06dc343f/checklistItems/33e9ca2d531b030038e7e91b06dc3458"},{"id":"api:/api/now/v1/fizz/buzz","label":"/api/now/v1/fizz/buzz","type":"api","nodeId":58,"endpoint":"/api/now/v1/fizz/buzz"},{"id":"api:/api/now/v1/batch","label":"/api/now/v1/batch","type":"api","nodeId":59,"endpoint":"/api/now/v1/batch"},{"id":"api:/api/now/graphql","label":"/api/now/graphql","type":"api","nodeId":60,"endpoint":"/api/now/graphql"},{"id":"api:api/users/:id","label":"api/users/:id","type":"api","nodeId":61,"endpoint":"api/users/:id"},{"id":"component:Search","label":"Search","type":"component","nodeId":62,"path":"G:\\Work\\Tenon\\Tenon Repo\\component-library\\Search","componentType":"Component Library","apiCount":2,"actionCount":6},{"id":"api:/api/now/v1/search/exactmatch?sysparm_term=:term&sysparm_search_context_config_id=:searchContextConfigId","label":"/api/now/v1/search/exactmatch?sysparm_term=:term&sysparm_search_context_config_id=:searchContextConfigId","type":"api","nodeId":63,"endpoint":"/api/now/v1/search/exactmatch?sysparm_term=:term&sysparm_search_context_config_id=:searchContextConfigId"},{"id":"component:SideModal","label":"SideModal","type":"component","nodeId":64,"path":"G:\\Work\\Tenon\\Tenon Repo\\component-library\\SideModal","componentType":"Component Library","apiCount":1,"actionCount":14},{"id":"api:/api/x_cadso_work/ui/requests/approve","label":"/api/x_cadso_work/ui/requests/approve","type":"api","nodeId":65,"endpoint":"/api/x_cadso_work/ui/requests/approve"},{"id":"component:SprintRetro","label":"SprintRetro","type":"component","nodeId":66,"path":"G:\\Work\\Tenon\\Tenon Repo\\component-library\\SprintRetro","componentType":"Component Library","apiCount":1,"actionCount":1},{"id":"component:Stats","label":"Stats","type":"component","nodeId":67,"path":"G:\\Work\\Tenon\\Tenon Repo\\component-library\\Stats","componentType":"Component Library","apiCount":2,"actionCount":1},{"id":"api:/api/x_cadso_work/ui/stats","label":"/api/x_cadso_work/ui/stats","type":"api","nodeId":68,"endpoint":"/api/x_cadso_work/ui/stats"},{"id":"api:/api/x_cadso_work/ui/metrics/fetch","label":"/api/x_cadso_work/ui/metrics/fetch","type":"api","nodeId":69,"endpoint":"/api/x_cadso_work/ui/metrics/fetch"},{"id":"component:TemplateCatalog","label":"TemplateCatalog","type":"component","nodeId":70,"path":"G:\\Work\\Tenon\\Tenon Repo\\component-library\\TemplateCatalog","componentType":"Component Library","apiCount":6,"actionCount":20},{"id":"api:/api/x_cadso_automate/ui/myTemplates","label":"/api/x_cadso_automate/ui/myTemplates","type":"api","nodeId":71,"endpoint":"/api/x_cadso_automate/ui/myTemplates"},{"id":"api:/api/x_cadso_automate/ui/template_catalog/:baseParam","label":"/api/x_cadso_automate/ui/template_catalog/:baseParam","type":"api","nodeId":72,"endpoint":"/api/x_cadso_automate/ui/template_catalog/:baseParam"},{"id":"api:/api/x_cadso_automate/ui/template_catalog/categories","label":"/api/x_cadso_automate/ui/template_catalog/categories","type":"api","nodeId":73,"endpoint":"/api/x_cadso_automate/ui/template_catalog/categories"},{"id":"api:/api/x_cadso_automate/ui/template_catalog/collections","label":"/api/x_cadso_automate/ui/template_catalog/collections","type":"api","nodeId":74,"endpoint":"/api/x_cadso_automate/ui/template_catalog/collections"}],"links":[{"source":4,"target":5,"type":"calls","sourceId":"component:Choice","targetId":"api:/api/x_cadso_work/ui/choice/fetch"},{"source":12,"target":13,"type":"calls","sourceId":"component:DateTime","targetId":"api:/api/x_cadso_work/ui/FormateDates"},{"source":15,"target":16,"type":"calls","sourceId":"component:FavoriteStar","targetId":"api:/api/x_cadso_work/ui/favorites/fetch"},{"source":15,"target":17,"type":"calls","sourceId":"component:FavoriteStar","targetId":"api:/api/x_cadso_work/ui/favorites/post"},{"source":18,"target":19,"type":"calls","sourceId":"component:MultiGlideList","targetId":"api:/api/x_cadso_work/ui/multiList/fetch"},{"source":22,"target":23,"type":"calls","sourceId":"component:Preview","targetId":"api:/api/x_cadso_core/component/fetchPreview/:table/:sysId"},{"source":27,"target":13,"type":"calls","sourceId":"component:Time","targetId":"api:/api/x_cadso_work/ui/FormateDates"},{"source":28,"target":29,"type":"calls","sourceId":"component:UpdateFieldsChoice","targetId":"api:/api/x_cadso_journey/ui/updateFields/fetch"},{"source":30,"target":31,"type":"calls","sourceId":"component:BrandKit","targetId":"api:/api/x_cadso_core/ui/brandKit/:sysId"},{"source":30,"target":32,"type":"calls","sourceId":"component:BrandKit","targetId":"api:/api/x_cadso_core/ui/brandKit"},{"source":33,"target":34,"type":"calls","sourceId":"component:ContentViewer","targetId":"api:api/now/table/:table/:sysId"},{"source":35,"target":36,"type":"calls","sourceId":"component:Editor","targetId":"api:/api/x_cadso_automate/ui/content_service/token"},{"source":35,"target":37,"type":"calls","sourceId":"component:Editor","targetId":"api:/api/x_cadso_automate/ui/content_templates/:sys_id"},{"source":35,"target":38,"type":"calls","sourceId":"component:Editor","targetId":"api:/api/x_cadso_automate/ui/template_catalog/templates/:item_id"},{"source":35,"target":39,"type":"calls","sourceId":"component:Editor","targetId":"api:/api/x_cadso_automate/ui/content_templates"},{"source":35,"target":40,"type":"calls","sourceId":"component:Editor","targetId":"api:/api/x_cadso_automate/ui/email/:sys_id"},{"source":35,"target":41,"type":"calls","sourceId":"component:Editor","targetId":"api:/api/x_cadso_automate/ui/brandKit/:sysId"},{"source":35,"target":42,"type":"calls","sourceId":"component:Editor","targetId":"api:/api/x_cadso_core/merge_tags"},{"source":35,"target":43,"type":"calls","sourceId":"component:Editor","targetId":"api:/api/x_cadso_core/ui/brandKit/all"},{"source":35,"target":31,"type":"calls","sourceId":"component:Editor","targetId":"api:/api/x_cadso_core/ui/brandKit/:sysId"},{"source":45,"target":42,"type":"calls","sourceId":"component:MergeTags","targetId":"api:/api/x_cadso_core/merge_tags"},{"source":45,"target":46,"type":"calls","sourceId":"component:MergeTags","targetId":"api:/api/x_cadso_core/merge_tags/:sys_id"},{"source":45,"target":47,"type":"calls","sourceId":"component:MergeTags","targetId":"api:/api/x_cadso_core/tables/:tableName/fields"},{"source":48,"target":49,"type":"calls","sourceId":"component:Modal","targetId":"api:/api/x_cadso_work/ui/requests/reject"},{"source":48,"target":50,"type":"calls","sourceId":"component:Modal","targetId":"api:/api/x_cadso_work/ui/navheader/event"},{"source":51,"target":52,"type":"calls","sourceId":"component:RecordDetails","targetId":"api:api/x_cadso_work/ui/list2"},{"source":51,"target":53,"type":"calls","sourceId":"component:RecordDetails","targetId":"api:api/x_cadso_work/ui/list"},{"source":54,"target":55,"type":"calls","sourceId":"component:RichTextEditor","targetId":"api:api/x_cadso_work/ui/complex_filter/additionalfiltersfetch"},{"source":54,"target":56,"type":"calls","sourceId":"component:RichTextEditor","targetId":"api:/api/now/uxframework/macroponent_drivers,/api/now/uxframework/component_drivers,/api/now/uxframework/scripted_conditions,/api/now/uxframework/scripted_route_conditions,/api/now/uxf/databroker/exec,/api/now/graphql"},{"source":54,"target":57,"type":"calls","sourceId":"component:RichTextEditor","targetId":"api:/api/now/v1/checklist/34edb69753d2030038e7e91b06dc343f/checklistItems/33e9ca2d531b030038e7e91b06dc3458"},{"source":54,"target":58,"type":"calls","sourceId":"component:RichTextEditor","targetId":"api:/api/now/v1/fizz/buzz"},{"source":54,"target":59,"type":"calls","sourceId":"component:RichTextEditor","targetId":"api:/api/now/v1/batch"},{"source":54,"target":60,"type":"calls","sourceId":"component:RichTextEditor","targetId":"api:/api/now/graphql"},{"source":54,"target":61,"type":"calls","sourceId":"component:RichTextEditor","targetId":"api:api/users/:id"},{"source":62,"target":63,"type":"calls","sourceId":"component:Search","targetId":"api:/api/now/v1/search/exactmatch?sysparm_term=:term&sysparm_search_context_config_id=:searchContextConfigId"},{"source":62,"target":60,"type":"calls","sourceId":"component:Search","targetId":"api:/api/now/graphql"},{"source":64,"target":65,"type":"calls","sourceId":"component:SideModal","targetId":"api:/api/x_cadso_work/ui/requests/approve"},{"source":66,"target":53,"type":"calls","sourceId":"component:SprintRetro","targetId":"api:api/x_cadso_work/ui/list"},{"source":67,"target":68,"type":"calls","sourceId":"component:Stats","targetId":"api:/api/x_cadso_work/ui/stats"},{"source":67,"target":69,"type":"calls","sourceId":"component:Stats","targetId":"api:/api/x_cadso_work/ui/metrics/fetch"},{"source":70,"target":71,"type":"calls","sourceId":"component:TemplateCatalog","targetId":"api:/api/x_cadso_automate/ui/myTemplates"},{"source":70,"target":72,"type":"calls","sourceId":"component:TemplateCatalog","targetId":"api:/api/x_cadso_automate/ui/template_catalog/:baseParam"},{"source":70,"target":73,"type":"calls","sourceId":"component:TemplateCatalog","targetId":"api:/api/x_cadso_automate/ui/template_catalog/categories"},{"source":70,"target":74,"type":"calls","sourceId":"component:TemplateCatalog","targetId":"api:/api/x_cadso_automate/ui/template_catalog/collections"},{"source":70,"target":38,"type":"calls","sourceId":"component:TemplateCatalog","targetId":"api:/api/x_cadso_automate/ui/template_catalog/templates/:item_id"},{"source":70,"target":39,"type":"calls","sourceId":"component:TemplateCatalog","targetId":"api:/api/x_cadso_automate/ui/content_templates"}],"stats":{"totalNodes":75,"totalLinks":46,"components":36,"apis":39,"scriptIncludes":0,"tables":0}};
        
        // Color scheme
        const colorScheme = {
            component: '#4CAF50',
            api: '#2196F3',
            scriptInclude: '#FF9800',
            table: '#9C27B0'
        };

        // Initialize D3
        const svg = d3.select('#svg-container');
        const width = window.innerWidth - 320;
        const height = window.innerHeight;
        
        svg.attr('viewBox', [0, 0, width, height]);

        // Create zoom behavior
        const zoom = d3.zoom()
            .scaleExtent([0.1, 10])
            .on('zoom', (event) => {
                g.attr('transform', event.transform);
            });

        svg.call(zoom);

        // Create main group
        const g = svg.append('g');

        // Create arrow markers for directed edges
        svg.append('defs').selectAll('marker')
            .data(['calls', 'invokes', 'depends', 'queries'])
            .enter().append('marker')
            .attr('id', d => 'arrow-' + d)
            .attr('viewBox', '0 -5 10 10')
            .attr('refX', 20)
            .attr('refY', 0)
            .attr('markerWidth', 6)
            .attr('markerHeight', 6)
            .attr('orient', 'auto')
            .append('path')
            .attr('d', 'M0,-5L10,0L0,5')
            .attr('fill', '#999');

        // Create force simulation
        const simulation = d3.forceSimulation(graphData.nodes)
            .force('link', d3.forceLink(graphData.links)
                .id(d => d.nodeId)
                .distance(100))
            .force('charge', d3.forceManyBody().strength(-300))
            .force('center', d3.forceCenter(width / 2, height / 2))
            .force('collision', d3.forceCollide().radius(30));

        // Create links
        const link = g.append('g')
            .selectAll('line')
            .data(graphData.links)
            .enter().append('line')
            .attr('class', 'link')
            .attr('stroke', '#999')
            .attr('stroke-width', d => d.type === 'depends' ? 2 : 1)
            .attr('marker-end', d => 'url(#arrow-' + d.type + ')');

        // Create nodes
        const node = g.append('g')
            .selectAll('circle')
            .data(graphData.nodes)
            .enter().append('circle')
            .attr('class', 'node')
            .attr('r', d => {
                switch(d.type) {
                    case 'component': return 12;
                    case 'api': return 10;
                    case 'scriptInclude': return 10;
                    case 'table': return 8;
                    default: return 8;
                }
            })
            .attr('fill', d => colorScheme[d.type] || '#666')
            .attr('stroke', '#fff')
            .attr('stroke-width', 2)
            .call(d3.drag()
                .on('start', dragstarted)
                .on('drag', dragged)
                .on('end', dragended));

        // Create labels
        const label = g.append('g')
            .selectAll('text')
            .data(graphData.nodes)
            .enter().append('text')
            .attr('class', 'node-label')
            .attr('text-anchor', 'middle')
            .attr('dy', -15)
            .text(d => d.label.length > 20 ? d.label.substring(0, 20) + '...' : d.label);

        // Update positions on simulation tick
        simulation.on('tick', () => {
            link
                .attr('x1', d => d.source.x)
                .attr('y1', d => d.source.y)
                .attr('x2', d => d.target.x)
                .attr('y2', d => d.target.y);

            node
                .attr('cx', d => d.x)
                .attr('cy', d => d.y);

            label
                .attr('x', d => d.x)
                .attr('y', d => d.y);
        });

        // Drag functions
        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }

        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }

        // Tooltip
        const tooltip = d3.select('.tooltip');
        
        node.on('mouseover', (event, d) => {
            let content = '<strong>' + d.label + '</strong><br>';
            content += 'Type: ' + d.type + '<br>';
            
            if (d.path) content += 'Path: ' + d.path + '<br>';
            if (d.componentType) content += 'Component Type: ' + d.componentType + '<br>';
            if (d.apiCount) content += 'API Count: ' + d.apiCount + '<br>';
            if (d.method) content += 'Method: ' + d.method + '<br>';
            if (d.resource) content += 'Resource: ' + d.resource + '<br>';
            
            tooltip.html(content)
                .style('left', (event.pageX + 10) + 'px')
                .style('top', (event.pageY - 10) + 'px')
                .classed('show', true);
        })
        .on('mouseout', () => {
            tooltip.classed('show', false);
        });

        // Context menu
        let selectedNode = null;
        const contextMenu = d3.select('.context-menu');

        node.on('contextmenu', (event, d) => {
            event.preventDefault();
            selectedNode = d;
            contextMenu
                .style('left', event.pageX + 'px')
                .style('top', event.pageY + 'px')
                .classed('show', true);
        });

        document.addEventListener('click', () => {
            contextMenu.classed('show', false);
        });

        // Highlight on click
        node.on('click', (event, d) => {
            event.stopPropagation();
            highlightConnections(d);
        });

        svg.on('click', () => {
            resetHighlight();
        });

        function highlightConnections(d) {
            // Reset all
            node.classed('highlight', false).classed('dimmed', true);
            link.classed('highlight', false).classed('dimmed', true);
            
            // Highlight selected node
            node.filter(n => n.nodeId === d.nodeId)
                .classed('highlight', true)
                .classed('dimmed', false);
            
            // Highlight connected nodes and links
            link.filter(l => l.source.nodeId === d.nodeId || l.target.nodeId === d.nodeId)
                .classed('highlight', true)
                .classed('dimmed', false)
                .each(function(l) {
                    node.filter(n => n.nodeId === l.source.nodeId || n.nodeId === l.target.nodeId)
                        .classed('dimmed', false);
                });
        }

        function resetHighlight() {
            node.classed('highlight', false).classed('dimmed', false);
            link.classed('highlight', false).classed('dimmed', false);
        }

        // Search functionality
        const searchInput = document.getElementById('search');
        const searchResults = document.getElementById('search-results');

        searchInput.addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            
            if (query.length < 2) {
                searchResults.classList.remove('show');
                return;
            }

            const matches = graphData.nodes.filter(n => 
                n.label.toLowerCase().includes(query)
            ).slice(0, 10);

            if (matches.length > 0) {
                searchResults.innerHTML = matches.map(n => 
                    '<div class="search-result" data-node-id="' + n.nodeId + '">' +
                    n.label + '<span class="search-result-type">(' + n.type + ')</span></div>'
                ).join('');
                searchResults.classList.add('show');

                // Add click handlers
                searchResults.querySelectorAll('.search-result').forEach(el => {
                    el.addEventListener('click', () => {
                        const nodeId = parseInt(el.dataset.nodeId);
                        const node = graphData.nodes.find(n => n.nodeId === nodeId);
                        if (node) {
                            highlightConnections(node);
                            
                            // Zoom to node
                            const transform = d3.zoomIdentity
                                .translate(width / 2, height / 2)
                                .scale(2)
                                .translate(-node.x, -node.y);
                            
                            svg.transition()
                                .duration(750)
                                .call(zoom.transform, transform);
                        }
                        searchResults.classList.remove('show');
                        searchInput.value = '';
                    });
                });
            } else {
                searchResults.classList.remove('show');
            }
        });

        // Control panel
        document.getElementById('force-strength').addEventListener('input', (e) => {
            const value = e.target.value;
            document.getElementById('force-value').textContent = value;
            simulation.force('charge').strength(+value);
            simulation.alpha(0.3).restart();
        });

        document.getElementById('link-distance').addEventListener('input', (e) => {
            const value = e.target.value;
            document.getElementById('distance-value').textContent = value;
            simulation.force('link').distance(+value);
            simulation.alpha(0.3).restart();
        });

        document.getElementById('show-labels').addEventListener('change', (e) => {
            label.style('display', e.target.checked ? 'block' : 'none');
        });

        // Node type filters
        document.querySelectorAll('.node-filter').forEach(checkbox => {
            checkbox.addEventListener('change', () => {
                const visibleTypes = Array.from(document.querySelectorAll('.node-filter:checked'))
                    .map(cb => cb.dataset.type);
                
                node.style('display', d => visibleTypes.includes(d.type) ? 'block' : 'none');
                label.style('display', d => {
                    const showLabels = document.getElementById('show-labels').checked;
                    return showLabels && visibleTypes.includes(d.type) ? 'block' : 'none';
                });
                
                // Hide links connected to hidden nodes
                link.style('display', l => {
                    const sourceVisible = visibleTypes.includes(l.source.type);
                    const targetVisible = visibleTypes.includes(l.target.type);
                    return sourceVisible && targetVisible ? 'block' : 'none';
                });
            });
        });

        // Sidebar toggle
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const toggle = document.getElementById('toggle-sidebar');
            sidebar.classList.toggle('collapsed');
            toggle.classList.toggle('collapsed');
            
            // Resize SVG
            const newWidth = sidebar.classList.contains('collapsed') 
                ? window.innerWidth 
                : window.innerWidth - 320;
            
            svg.attr('viewBox', [0, 0, newWidth, height]);
            simulation.force('center', d3.forceCenter(newWidth / 2, height / 2));
            simulation.alpha(0.3).restart();
        }

        // Export functions
        function exportSVG() {
            const svgData = document.getElementById('svg-container').outerHTML;
            const blob = new Blob([svgData], { type: 'image/svg+xml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'dependency-graph.svg';
            a.click();
            URL.revokeObjectURL(url);
        }

        function exportPNG() {
            const svgElement = document.getElementById('svg-container');
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const svgData = new XMLSerializer().serializeToString(svgElement);
            const img = new Image();
            
            canvas.width = width;
            canvas.height = height;
            
            img.onload = () => {
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, width, height);
                ctx.drawImage(img, 0, 0);
                
                canvas.toBlob(blob => {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'dependency-graph.png';
                    a.click();
                    URL.revokeObjectURL(url);
                });
            };
            
            img.src = 'data:image/svg+xml;base64,' + btoa(svgData);
        }

        function exportJSON() {
            const blob = new Blob([JSON.stringify(graphData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'dependency-graph.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Context menu functions
        function focusNode() {
            if (selectedNode) {
                highlightConnections(selectedNode);
                const transform = d3.zoomIdentity
                    .translate(width / 2, height / 2)
                    .scale(2)
                    .translate(-selectedNode.x, -selectedNode.y);
                
                svg.transition()
                    .duration(750)
                    .call(zoom.transform, transform);
            }
        }

        function showConnections() {
            if (selectedNode) {
                highlightConnections(selectedNode);
            }
        }

        function hideNode() {
            if (selectedNode) {
                node.filter(n => n.nodeId === selectedNode.nodeId)
                    .style('display', 'none');
                label.filter(n => n.nodeId === selectedNode.nodeId)
                    .style('display', 'none');
                link.filter(l => l.source.nodeId === selectedNode.nodeId || l.target.nodeId === selectedNode.nodeId)
                    .style('display', 'none');
            }
        }

        function copyNodeInfo() {
            if (selectedNode) {
                const info = JSON.stringify(selectedNode, null, 2);
                navigator.clipboard.writeText(info);
            }
        }

        // Window resize
        window.addEventListener('resize', () => {
            const sidebar = document.getElementById('sidebar');
            const newWidth = sidebar.classList.contains('collapsed') 
                ? window.innerWidth 
                : window.innerWidth - 320;
            const newHeight = window.innerHeight;
            
            svg.attr('viewBox', [0, 0, newWidth, newHeight]);
            simulation.force('center', d3.forceCenter(newWidth / 2, newHeight / 2));
            simulation.alpha(0.3).restart();
        });
    </script>
</body>
</html>