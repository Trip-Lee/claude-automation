{
  "_metadata": {
    "table": "sys_script_include",
    "sys_id": "ff0c77f4336022507b18bc534d5c7b00",
    "extracted_at": "2025-09-19T21:48:29.069Z",
    "display_value": "LeadScoringMS",
    "application": "Tenon_Marketing_Automation",
    "scope": {
      "display_value": "Tenon Marketing Automation",
      "link": "https://tenonworkstudio.service-now.com/api/now/table/sys_scope/5e9f5f8b87420250369f33373cbb3559",
      "value": "5e9f5f8b87420250369f33373cbb3559"
    }
  },
  "client_callable": {
    "value": "false",
    "display_value": "false"
  },
  "access": {
    "value": "public",
    "display_value": "All application scopes"
  },
  "mobile_callable": {
    "value": "false",
    "display_value": "false"
  },
  "sys_mod_count": {
    "value": "20",
    "display_value": "20"
  },
  "active": {
    "value": "true",
    "display_value": "true"
  },
  "description": {
    "value": "",
    "display_value": ""
  },
  "sys_updated_on": {
    "value": "2025-04-01 22:15:20",
    "display_value": "2025-04-01 03:15:20 PM"
  },
  "sys_tags": {
    "value": "",
    "display_value": ""
  },
  "sandbox_callable": {
    "value": "false",
    "display_value": "false"
  },
  "script": {
    "value": "var LeadScoringMS = Class.create();\r\nLeadScoringMS.prototype = {\r\n    initialize: function() {},\r\n\r\n    getScore: function(event, eventType) {\r\n        var score = 0;\r\n\r\n        if (event && eventType) {\r\n            var leadDefGR = new GlideRecord('x_cadso_automate_event_score_definition');\r\n            leadDefGR.addQuery('event', event);\r\n            leadDefGR.addQuery('event_type', eventType);\r\n            leadDefGR.setLimit(1);\r\n            leadDefGR.query();\r\n\r\n            if (leadDefGR.next()) {\r\n                score = leadDefGR.getValue('score');\r\n                score = parseInt(score);\r\n            }\r\n        }\r\n        return score;\r\n    },\r\n\r\n\tcalculateScores: function(){\r\n\t\tvar leadScoringEnabled = gs.getProperty(\"x_cadso_automate.tenon_marketing_lead_scoring\");\r\n\t\tif(leadScoringEnabled == \"true\"){\r\n\t\tvar totalScore = 0;\r\n\t\tvar currentScore = 0;\r\n\t\tvar newScore = 0;\r\n\t\tvar leadEventGA = new GlideAggregate(\"x_cadso_automate_lead_event\");\r\n\t\tleadEventGA.addQuery(\"lead!=NULL\");\r\n\t\tleadEventGA.groupBy(\"lead\");\r\n\t\tleadEventGA.addAggregate(\"SUM\", \"score\");\r\n\t\tleadEventGA.query();\r\n\r\n\t\twhile(leadEventGA.next()){\r\n\t\t\ttotalScore = leadEventGA.getAggregate(\"SUM\", \"score\");\r\n\t\t\tif(totalScore > 0 ){\r\n\t\t\t\tvar leadRecord = leadEventGA.getValue(\"lead\");\r\n\t\t\t\tvar leadGR = new GlideRecord(\"sn_lead_mgmt_core_lead\");\r\n\t\t\t\tleadGR.addQuery(\"sys_id\", leadRecord);\r\n\t\t\t\tleadGR.query();\r\n\t\t\t\tif(leadGR.next()){\r\n\t\t\t\t\tcurrentScore = leadGR.lead_score;\r\n\t\t\t\t\tnewScore = totalScore + currentScore;\r\n\t\t\t\t\tleadGR.lead_score = newScore;\r\n\t\t\t\t\tleadGR.lead_rating = getLeadRating(newScore);\r\n\t\t\t\t\tleadGR.update();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t},\r\n\r\n\tdeleteLeadEvents: function(){\r\n\r\n\t\tvar leadEventsDeleteGR = new GlideRecord(\"x_cadso_automate_lead_event\");\r\n\t\tleadEventsDeleteGR.query();\r\n\t\tleadEventsDeleteGR.setWorkflow(false);\r\n\t\tleadEventsDeleteGR.deleteMultiple();\r\n\t\t\r\n\t},\r\n\r\n\tgetLeadRating: function(score) {\r\n    const leadRatings = [{\r\n            scoreRange: [90, 100],\r\n            rating: 'Super Hot'\r\n        },\r\n        {\r\n            scoreRange: [70, 89],\r\n            rating: 'Hot'\r\n        },\r\n        {\r\n            scoreRange: [31, 69],\r\n            rating: 'Warm'\r\n        },\r\n        {\r\n            scoreRange: [0, 30],\r\n            rating: 'Cold'\r\n        },\r\n    ];\r\n    const rating = leadRatings.find(r => score >= r.scoreRange[0] && score <= r.scoreRange[1]);\r\n    return rating.rating;\r\n},\r\n    type: 'LeadScoringMS'\r\n};",
    "display_value": "var LeadScoringMS = Class.create();\r\nLeadScoringMS.prototype = {\r\n    initialize: function() {},\r\n\r\n    getScore: function(event, eventType) {\r\n        var score = 0;\r\n\r\n        if (event && eventType) {\r\n            var leadDefGR = new GlideRecord('x_cadso_automate_event_score_definition');\r\n            leadDefGR.addQuery('event', event);\r\n            leadDefGR.addQuery('event_type', eventType);\r\n            leadDefGR.setLimit(1);\r\n            leadDefGR.query();\r\n\r\n            if (leadDefGR.next()) {\r\n                score = leadDefGR.getValue('score');\r\n                score = parseInt(score);\r\n            }\r\n        }\r\n        return score;\r\n    },\r\n\r\n\tcalculateScores: function(){\r\n\t\tvar leadScoringEnabled = gs.getProperty(\"x_cadso_automate.tenon_marketing_lead_scoring\");\r\n\t\tif(leadScoringEnabled == \"true\"){\r\n\t\tvar totalScore = 0;\r\n\t\tvar currentScore = 0;\r\n\t\tvar newScore = 0;\r\n\t\tvar leadEventGA = new GlideAggregate(\"x_cadso_automate_lead_event\");\r\n\t\tleadEventGA.addQuery(\"lead!=NULL\");\r\n\t\tleadEventGA.groupBy(\"lead\");\r\n\t\tleadEventGA.addAggregate(\"SUM\", \"score\");\r\n\t\tleadEventGA.query();\r\n\r\n\t\twhile(leadEventGA.next()){\r\n\t\t\ttotalScore = leadEventGA.getAggregate(\"SUM\", \"score\");\r\n\t\t\tif(totalScore > 0 ){\r\n\t\t\t\tvar leadRecord = leadEventGA.getValue(\"lead\");\r\n\t\t\t\tvar leadGR = new GlideRecord(\"sn_lead_mgmt_core_lead\");\r\n\t\t\t\tleadGR.addQuery(\"sys_id\", leadRecord);\r\n\t\t\t\tleadGR.query();\r\n\t\t\t\tif(leadGR.next()){\r\n\t\t\t\t\tcurrentScore = leadGR.lead_score;\r\n\t\t\t\t\tnewScore = totalScore + currentScore;\r\n\t\t\t\t\tleadGR.lead_score = newScore;\r\n\t\t\t\t\tleadGR.lead_rating = getLeadRating(newScore);\r\n\t\t\t\t\tleadGR.update();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t},\r\n\r\n\tdeleteLeadEvents: function(){\r\n\r\n\t\tvar leadEventsDeleteGR = new GlideRecord(\"x_cadso_automate_lead_event\");\r\n\t\tleadEventsDeleteGR.query();\r\n\t\tleadEventsDeleteGR.setWorkflow(false);\r\n\t\tleadEventsDeleteGR.deleteMultiple();\r\n\t\t\r\n\t},\r\n\r\n\tgetLeadRating: function(score) {\r\n    const leadRatings = [{\r\n            scoreRange: [90, 100],\r\n            rating: 'Super Hot'\r\n        },\r\n        {\r\n            scoreRange: [70, 89],\r\n            rating: 'Hot'\r\n        },\r\n        {\r\n            scoreRange: [31, 69],\r\n            rating: 'Warm'\r\n        },\r\n        {\r\n            scoreRange: [0, 30],\r\n            rating: 'Cold'\r\n        },\r\n    ];\r\n    const rating = leadRatings.find(r => score >= r.scoreRange[0] && score <= r.scoreRange[1]);\r\n    return rating.rating;\r\n},\r\n    type: 'LeadScoringMS'\r\n};",
    "formatted_script": {
      "line_count": 86,
      "char_count": 2448,
      "preview": "var LeadScoringMS = Class.create();\r\nLeadScoringMS.prototype = {\r\n    initialize: function() {},\r\n\r\n    getScore: function(event, eventType) {\r\n        var score = 0;\r\n\r\n        if (event && eventType...",
      "full_script": "var LeadScoringMS = Class.create();\r\nLeadScoringMS.prototype = {\r\n    initialize: function() {},\r\n\r\n    getScore: function(event, eventType) {\r\n        var score = 0;\r\n\r\n        if (event && eventType) {\r\n            var leadDefGR = new GlideRecord('x_cadso_automate_event_score_definition');\r\n            leadDefGR.addQuery('event', event);\r\n            leadDefGR.addQuery('event_type', eventType);\r\n            leadDefGR.setLimit(1);\r\n            leadDefGR.query();\r\n\r\n            if (leadDefGR.next()) {\r\n                score = leadDefGR.getValue('score');\r\n                score = parseInt(score);\r\n            }\r\n        }\r\n        return score;\r\n    },\r\n\r\n\tcalculateScores: function(){\r\n\t\tvar leadScoringEnabled = gs.getProperty(\"x_cadso_automate.tenon_marketing_lead_scoring\");\r\n\t\tif(leadScoringEnabled == \"true\"){\r\n\t\tvar totalScore = 0;\r\n\t\tvar currentScore = 0;\r\n\t\tvar newScore = 0;\r\n\t\tvar leadEventGA = new GlideAggregate(\"x_cadso_automate_lead_event\");\r\n\t\tleadEventGA.addQuery(\"lead!=NULL\");\r\n\t\tleadEventGA.groupBy(\"lead\");\r\n\t\tleadEventGA.addAggregate(\"SUM\", \"score\");\r\n\t\tleadEventGA.query();\r\n\r\n\t\twhile(leadEventGA.next()){\r\n\t\t\ttotalScore = leadEventGA.getAggregate(\"SUM\", \"score\");\r\n\t\t\tif(totalScore > 0 ){\r\n\t\t\t\tvar leadRecord = leadEventGA.getValue(\"lead\");\r\n\t\t\t\tvar leadGR = new GlideRecord(\"sn_lead_mgmt_core_lead\");\r\n\t\t\t\tleadGR.addQuery(\"sys_id\", leadRecord);\r\n\t\t\t\tleadGR.query();\r\n\t\t\t\tif(leadGR.next()){\r\n\t\t\t\t\tcurrentScore = leadGR.lead_score;\r\n\t\t\t\t\tnewScore = totalScore + currentScore;\r\n\t\t\t\t\tleadGR.lead_score = newScore;\r\n\t\t\t\t\tleadGR.lead_rating = getLeadRating(newScore);\r\n\t\t\t\t\tleadGR.update();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t},\r\n\r\n\tdeleteLeadEvents: function(){\r\n\r\n\t\tvar leadEventsDeleteGR = new GlideRecord(\"x_cadso_automate_lead_event\");\r\n\t\tleadEventsDeleteGR.query();\r\n\t\tleadEventsDeleteGR.setWorkflow(false);\r\n\t\tleadEventsDeleteGR.deleteMultiple();\r\n\t\t\r\n\t},\r\n\r\n\tgetLeadRating: function(score) {\r\n    const leadRatings = [{\r\n            scoreRange: [90, 100],\r\n            rating: 'Super Hot'\r\n        },\r\n        {\r\n            scoreRange: [70, 89],\r\n            rating: 'Hot'\r\n        },\r\n        {\r\n            scoreRange: [31, 69],\r\n            rating: 'Warm'\r\n        },\r\n        {\r\n            scoreRange: [0, 30],\r\n            rating: 'Cold'\r\n        },\r\n    ];\r\n    const rating = leadRatings.find(r => score >= r.scoreRange[0] && score <= r.scoreRange[1]);\r\n    return rating.rating;\r\n},\r\n    type: 'LeadScoringMS'\r\n};"
    }
  },
  "sys_class_name": {
    "value": "sys_script_include",
    "display_value": "Script Include"
  },
  "sys_package": {
    "value": "5e9f5f8b87420250369f33373cbb3559",
    "display_value": "Tenon Marketing Automation"
  },
  "sys_update_name": {
    "value": "sys_script_include_ff0c77f4336022507b18bc534d5c7b00",
    "display_value": "sys_script_include_ff0c77f4336022507b18bc534d5c7b00"
  },
  "sys_updated_by": {
    "value": "rumman.tariq",
    "display_value": "rumman.tariq"
  },
  "api_name": {
    "value": "x_cadso_automate.LeadScoringMS",
    "display_value": "x_cadso_automate.LeadScoringMS"
  },
  "sys_created_on": {
    "value": "2025-03-25 19:39:38",
    "display_value": "2025-03-25 12:39:38 PM"
  },
  "caller_access": {
    "value": "",
    "display_value": null
  },
  "name": {
    "value": "LeadScoringMS",
    "display_value": "LeadScoringMS"
  },
  "sys_name": {
    "value": "LeadScoringMS",
    "display_value": "LeadScoringMS"
  },
  "sys_scope": {
    "value": "5e9f5f8b87420250369f33373cbb3559",
    "display_value": "Tenon Marketing Automation"
  },
  "sys_created_by": {
    "value": "will.mcgill",
    "display_value": "will.mcgill"
  },
  "sys_policy": {
    "value": "read",
    "display_value": "Read-only"
  }
}
